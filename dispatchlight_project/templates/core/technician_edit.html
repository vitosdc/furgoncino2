{% extends 'base.html' %}{% block title %}Modifica {{ technician.user.get_full_name }} - DispatchLight{% endblock %}{% block content %}<div class="row">    <div class="col-12">        <div class="d-flex justify-content-between align-items-center mb-4">            <h1><i class="fas fa-edit"></i> Modifica Tecnico</h1>            <a href="{% url 'core:technician_detail' technician.pk %}" class="btn btn-outline-secondary">                <i class="fas fa-arrow-left"></i> Torna ai Dettagli            </a>        </div>    </div></div><div class="row justify-content-center">    <div class="col-lg-8">        <div class="card">            <div class="card-header">                <h5><i class="fas fa-user-edit"></i> Modifica Informazioni - {{ technician.user.get_full_name }}</h5>            </div>            <div class="card-body">                <form method="post">                    {% csrf_token %}                                        <!-- Informazioni Non Modificabili -->                    <div class="alert alert-info">                        <h6><i class="fas fa-info-circle"></i> Informazioni Account (Non Modificabili)</h6>                        <div class="row">                            <div class="col-md-6">                                <strong>Nome:</strong> {{ technician.user.first_name }} {{ technician.user.last_name }}                            </div>                            <div class="col-md-6">                                <strong>Username:</strong> {{ technician.user.username }}                            </div>                        </div>                        <div class="row mt-2">                            <div class="col-md-6">                                <strong>Email:</strong> {{ technician.user.email }}                            </div>                            <div class="col-md-6">                                <small class="text-muted">Per modificare i dati account, contatta l'amministratore.</small>                            </div>                        </div>                    </div>                                        <!-- Campi Modificabili -->                    <div class="row">                        <div class="col-md-6 mb-3">                            <label for="{{ form.phone.id_for_label }}" class="form-label">                                <i class="fas fa-phone"></i> {{ form.phone.label }}                            </label>                            {{ form.phone }}                            {% if form.phone.errors %}                                <div class="text-danger small">{{ form.phone.errors }}</div>                            {% endif %}                            <div class="form-text">Numero di telefono principale del tecnico</div>                        </div>                                                <div class="col-md-6 mb-3">                            <label for="{{ form.vehicle_plate.id_for_label }}" class="form-label">                                <i class="fas fa-car"></i> {{ form.vehicle_plate.label }}                            </label>                            {{ form.vehicle_plate }}                            {% if form.vehicle_plate.errors %}                                <div class="text-danger small">{{ form.vehicle_plate.errors }}</div>                            {% endif %}                            <div class="form-text">Targa del veicolo aziendale (opzionale)</div>                        </div>                    </div>                                        <!-- Stato Attivo -->                    <div class="mb-4">                        <div class="form-check form-switch">                            {{ form.is_active }}                            <label class="form-check-label" for="{{ form.is_active.id_for_label }}">                                <i class="fas fa-toggle-on"></i> {{ form.is_active.label }}                            </label>                            {% if form.is_active.errors %}                                <div class="text-danger small">{{ form.is_active.errors }}</div>                            {% endif %}                        </div>                        <small class="form-text text-muted">                            Se disattivato, il tecnico non potrà ricevere nuovi ordini e non apparirà nelle assegnazioni.                        </small>                    </div>                                        <!-- Informazioni GPS -->                    <div class="card bg-light mb-4">                        <div class="card-body">                            <h6><i class="fas fa-map-marker-alt"></i> Informazioni GPS</h6>                            {% if technician.current_latitude and technician.current_longitude %}                                <div class="row">                                    <div class="col-md-6">                                        <small class="text-muted">Latitudine:</small><br>                                        <span class="badge bg-success">{{ technician.current_latitude|floatformat:6 }}</span>                                    </div>                                    <div class="col-md-6">                                        <small class="text-muted">Longitudine:</small><br>                                        <span class="badge bg-success">{{ technician.current_longitude|floatformat:6 }}</span>                                    </div>                                </div>                                {% if technician.last_location_update %}                                    <small class="text-muted">                                        Ultimo aggiornamento: {{ technician.last_location_update|date:"d/m/Y H:i" }}                                    </small>                                {% endif %}                            {% else %}                                <div class="alert alert-warning mb-0">                                    <i class="fas fa-exclamation-triangle"></i>                                    Il tecnico non ha ancora condiviso la sua posizione GPS.                                </div>                            {% endif %}                        </div>                    </div>                                        <!-- Errori generali del form -->                    {% if form.non_field_errors %}                        <div class="alert alert-danger">                            {{ form.non_field_errors }}                        </div>                    {% endif %}                                        <!-- Pulsanti di azione -->                    <div class="d-flex justify-content-end gap-2">                        <a href="{% url 'core:technician_detail' technician.pk %}" class="btn btn-secondary">                            <i class="fas fa-times"></i> Annulla                        </a>                        <button type="submit" class="btn btn-primary">                            <i class="fas fa-save"></i> Salva Modifiche                        </button>                    </div>                </form>            </div>        </div>                <!-- Azioni Avanzate -->        <div class="card mt-4">            <div class="card-header bg-warning text-dark">                <h5><i class="fas fa-exclamation-triangle"></i> Azioni Avanzate</h5>            </div>            <div class="card-body">                <div class="row">                    <div class="col-md-6">                        <h6>Reset Password</h6>                        <p class="text-muted small">                            Genera una nuova password temporanea per il tecnico.                        </p>                        <button class="btn btn-outline-warning btn-sm" onclick="resetPassword()">                            <i class="fas fa-key"></i> Reset Password                        </button>                    </div>                    <div class="col-md-6">                        <h6>Cancella Posizione GPS</h6>                        <p class="text-muted small">                            Rimuove i dati di geolocalizzazione memorizzati.                        </p>                        <button class="btn btn-outline-info btn-sm" onclick="clearGPS()">                            <i class="fas fa-map-marker-slash"></i> Cancella GPS                        </button>                    </div>                </div>            </div>        </div>    </div></div><!-- Script per azioni avanzate --><script>function resetPassword() {    if (confirm('Vuoi davvero generare una nuova password per {{ technician.user.get_full_name }}?')) {        alert('Funzionalità in sviluppo: invieremo una nuova password via email al tecnico.');    }}function clearGPS() {    if (confirm('Vuoi davvero cancellare i dati GPS di {{ technician.user.get_full_name }}?')) {        alert('Funzionalità in sviluppo: i dati GPS verranno rimossi.');    }}</script><style>.form-control:focus {    border-color: #007bff;    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);}.form-check-input:checked {    background-color: #28a745;    border-color: #28a745;}.card {    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);}</style>{% endblock %}