{% extends 'base.html' %}{% block title %}{{ technician.user.get_full_name }} - Dettagli Tecnico{% endblock %}{% block content %}<div class="row">    <div class="col-12">        <div class="d-flex justify-content-between align-items-center mb-4">            <h1><i class="fas fa-user-cog"></i> {{ technician.user.get_full_name }}</h1>            <div>                <a href="{% url 'core:technician_edit' technician.pk %}" class="btn btn-outline-warning">                    <i class="fas fa-edit"></i> Modifica                </a>                <a href="{% url 'core:technician_locate' technician.pk %}" class="btn btn-outline-info">                    <i class="fas fa-map-marker-alt"></i> Localizza                </a>                <a href="{% url 'core:technician_list' %}" class="btn btn-outline-secondary">                    <i class="fas fa-arrow-left"></i> Torna alla Lista                </a>            </div>        </div>    </div></div><div class="row">    <!-- Informazioni Tecnico -->    <div class="col-lg-4">        <div class="card">            <div class="card-header">                <h5><i class="fas fa-user"></i> Informazioni Personali</h5>            </div>            <div class="card-body">                <dl class="row">                    <dt class="col-sm-5">Nome:</dt>                    <dd class="col-sm-7">{{ technician.user.first_name }} {{ technician.user.last_name }}</dd>                                        <dt class="col-sm-5">Username:</dt>                    <dd class="col-sm-7">{{ technician.user.username }}</dd>                                        <dt class="col-sm-5">Email:</dt>                    <dd class="col-sm-7">                        <a href="mailto:{{ technician.user.email }}">{{ technician.user.email }}</a>                    </dd>                                        <dt class="col-sm-5">Telefono:</dt>                    <dd class="col-sm-7">                        <a href="tel:{{ technician.phone }}">{{ technician.phone }}</a>                    </dd>                                        <dt class="col-sm-5">Veicolo:</dt>                    <dd class="col-sm-7">                        {% if technician.vehicle_plate %}                            <span class="badge bg-secondary">{{ technician.vehicle_plate }}</span>                        {% else %}                            <span class="text-muted">Non specificato</span>                        {% endif %}                    </dd>                                        <dt class="col-sm-5">Stato:</dt>                    <dd class="col-sm-7">                        {% if technician.is_active %}                            <span class="badge bg-success">Attivo</span>                        {% else %}                            <span class="badge bg-secondary">Inattivo</span>                        {% endif %}                    </dd>                </dl>            </div>        </div>        <!-- Statistiche Performance -->        <div class="card mt-4">            <div class="card-header">                <h5><i class="fas fa-chart-bar"></i> Statistiche Performance</h5>            </div>            <div class="card-body">                <div class="row text-center">                    <div class="col-6">                        <h4 class="text-primary">{{ total_orders }}</h4>                        <small class="text-muted">Ordini Totali</small>                    </div>                    <div class="col-6">                        <h4 class="text-success">{{ completed_orders }}</h4>                        <small class="text-muted">Completati</small>                    </div>                </div>                <hr>                <div class="row text-center">                    <div class="col-6">                        <h4 class="text-info">{{ completion_rate }}%</h4>                        <small class="text-muted">Tasso Completamento</small>                    </div>                    <div class="col-6">                        <h4 class="text-warning">{{ pending_orders }}</h4>                        <small class="text-muted">In Attesa</small>                    </div>                </div>                                <!-- Barra Progress -->                <div class="mt-3">                    <label class="small text-muted">Performance Globale:</label>                    <div class="progress" style="height: 10px;">                        <div class="progress-bar {% if completion_rate >= 80 %}bg-success{% elif completion_rate >= 60 %}bg-warning{% else %}bg-info{% endif %}"                              style="width: {{ completion_rate }}%">                        </div>                    </div>                    <small class="text-muted">{{ completion_rate }}% di successo</small>                </div>            </div>        </div>        <!-- Posizione GPS -->        <div class="card mt-4">            <div class="card-header">                <h5><i class="fas fa-map-marker-alt"></i> Posizione GPS</h5>            </div>            <div class="card-body">                {% if technician.current_latitude and technician.current_longitude %}                    <div class="alert alert-success">                        <strong><i class="fas fa-check-circle"></i> GPS Attivo</strong><br>                        <small class="text-muted">                            Lat: {{ technician.current_latitude|floatformat:6 }}<br>                            Lng: {{ technician.current_longitude|floatformat:6 }}                        </small>                        {% if technician.last_location_update %}                            <br><small class="text-muted">                                Aggiornato {{ technician.last_location_update|timesince }} fa                            </small>                        {% endif %}                    </div>                    <a href="{% url 'core:technician_locate' technician.pk %}" class="btn btn-outline-info btn-sm w-100">                        <i class="fas fa-map-marked-alt"></i> Visualizza sulla Mappa                    </a>                {% else %}                    <div class="alert alert-warning">                        <strong><i class="fas fa-exclamation-triangle"></i> GPS Non Disponibile</strong><br>                        <small>Il tecnico non ha ancora condiviso la sua posizione.</small>                    </div>                {% endif %}            </div>        </div>    </div>        <!-- Ordini e AttivitÃ  -->    <div class="col-lg-8">        <!-- Ordini Attivi -->        {% if active_orders %}        <div class="card mb-4">            <div class="card-header bg-warning text-dark">                <h5><i class="fas fa-clock"></i> Ordini Attivi ({{ active_orders|length }})</h5>            </div>            <div class="card-body">                <div class="table-responsive">                    <table class="table table-sm table-hover">                        <thead>                            <tr>                                <th>Numero</th>                                <th>Cliente</th>                                <th>Titolo</th>                                <th>Stato</th>                                <th>Data</th>                                <th>Azioni</th>                            </tr>                        </thead>                        <tbody>                            {% for order in active_orders %}                            <tr>                                <td><strong>{{ order.order_number }}</strong></td>                                <td>{{ order.customer.name }}</td>                                <td>{{ order.title|truncatechars:30 }}</td>                                <td>                                    {% if order.status == 'PENDING' %}                                        <span class="badge bg-warning">Da Assegnare</span>                                    {% elif order.status == 'ASSIGNED' %}                                        <span class="badge bg-info">Assegnato</span>                                    {% elif order.status == 'EN_ROUTE' %}                                        <span class="badge bg-primary">In Viaggio</span>                                    {% elif order.status == 'ON_SITE' %}                                        <span class="badge bg-secondary">Sul Posto</span>                                    {% endif %}                                </td>                                <td>{{ order.created_at|date:"d/m/Y" }}</td>                                <td>                                    <a href="{% url 'core:order_detail' order.pk %}" class="btn btn-sm btn-outline-primary">                                        <i class="fas fa-eye"></i>                                    </a>                                </td>                            </tr>                            {% endfor %}                        </tbody>                    </table>                </div>            </div>        </div>        {% endif %}        <!-- Storico Ordini -->        <div class="card">            <div class="card-header">                <h5><i class="fas fa-history"></i> Storico Ordini Recenti</h5>            </div>            <div class="card-body">                {% if recent_orders %}                <div class="table-responsive">                    <table class="table table-hover">                        <thead>                            <tr>                                <th>Numero</th>                                <th>Cliente</th>                                <th>Titolo</th>                                <th>Stato</th>                                <th>Data</th>                                <th>Azioni</th>                            </tr>                        </thead>                        <tbody>                            {% for order in recent_orders %}                            <tr>                                <td><strong>{{ order.order_number }}</strong></td>                                <td>{{ order.customer.name }}</td>                                <td>{{ order.title|truncatechars:40 }}</td>                                <td>                                    {% if order.status == 'PENDING' %}                                        <span class="badge bg-warning">Da Assegnare</span>                                    {% elif order.status == 'ASSIGNED' %}                                        <span class="badge bg-info">Assegnato</span>                                    {% elif order.status == 'EN_ROUTE' %}                                        <span class="badge bg-primary">In Viaggio</span>                                    {% elif order.status == 'ON_SITE' %}                                        <span class="badge bg-secondary">Sul Posto</span>                                    {% elif order.status == 'COMPLETED' %}                                        <span class="badge bg-success">Completato</span>                                    {% elif order.status == 'CANCELLED' %}                                        <span class="badge bg-danger">Annullato</span>                                    {% endif %}                                </td>                                <td>{{ order.created_at|date:"d/m/Y H:i" }}</td>                                <td>                                    <a href="{% url 'core:order_detail' order.pk %}" class="btn btn-sm btn-outline-primary">                                        <i class="fas fa-eye"></i>                                    </a>                                </td>                            </tr>                            {% endfor %}                        </tbody>                    </table>                </div>                {% else %}                <div class="text-center py-4">                    <i class="fas fa-clipboard-list fa-3x text-muted mb-3"></i>                    <h5 class="text-muted">Nessun ordine assegnato</h5>                    <p class="text-muted">Questo tecnico non ha ancora ordini assegnati.</p>                </div>                {% endif %}            </div>        </div>    </div></div>{% endblock %}